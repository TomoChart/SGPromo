<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Decision Factors</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <main class="container">
    <h2>Decision Making Factors</h2>
    <form id="decisionForm">
      <label>Key purchase driver (jedan odabir):</label>
      <div id="keyDriver" class="bubble-group">
        <div class="bubble radio" data-value="Camera">Camera</div>
        <div class="bubble radio" data-value="Processor">Processor</div>
        <div class="bubble radio" data-value="Battery">Battery</div>
        <div class="bubble radio" data-value="Price">Price</div>
        <div class="bubble radio" data-value="AI">AI</div>
      </div>

      <label>Top Rated Features:</label>
      <details>
        <summary>True AI companion</summary>
        <div id="trueAI" class="bubble-group">
          <div class="bubble radio" data-value="Human-like AI Agent">Human-like AI Agent</div>
          <div class="bubble radio" data-value="Integrated AI Platform">Integrated AI Platform</div>
          <div class="bubble radio" data-value="Personalized AI">Personalized AI</div>
        </div>
      </details>
      <details>
        <summary>Performance</summary>
        <div id="performance" class="bubble-group">
          <div class="bubble radio" data-value="Gaming">Gaming</div>
          <div class="bubble radio" data-value="Next gen processor">Next gen processor</div>
          <div class="bubble radio" data-value="Realistic viewing">Realistic viewing</div>
        </div>
      </details>
      <details>
        <summary>Camera Experience</summary>
        <div id="cameraExp" class="bubble-group">
          <div class="bubble radio" data-value="Generative Photo Edit">Generative Photo Edit</div>
          <div class="bubble radio" data-value="Audio Eraser">Audio Eraser</div>
          <div class="bubble radio" data-value="Sketch to Image">Sketch to Image</div>
        </div>
      </details>

      <button type="submit" class="primary-btn">Pošalji</button>
    </form>
  </main>
  <script>
    // --- Airtable API podaci ---
    const API_TOKEN = "patxfw0F5FppZNEog.ea19d0619748bb20058c2f8423708ca1e52ca514faf01708b1255884ce6e0565";
    const BASE_ID = "appQmtnEDB8KmTcNm";
    const TABLE_NAME = "Consumer_insights-Grid view";

    // Bubble radio single-choice za svaku grupu
    function singleSelect(groupSelector) {
      document.querySelectorAll(groupSelector + ' .radio').forEach(el => {
        el.addEventListener('click', () => {
          document.querySelectorAll(groupSelector + ' .radio').forEach(r => r.classList.remove('selected'));
          el.classList.add('selected');
        });
      });
    }
    singleSelect('#keyDriver');
    singleSelect('#trueAI');
    singleSelect('#performance');
    singleSelect('#cameraExp');

    // Slanje forme u Airtable
    document.getElementById('decisionForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      function getSelectedValue(groupSelector) {
        const sel = document.querySelector(groupSelector + ' .selected');
        return sel ? sel.dataset.value : "";
      }

      const keyDriver = getSelectedValue('#keyDriver');
      const trueAI = getSelectedValue('#trueAI');
      const performance = getSelectedValue('#performance');
      const cameraExp = getSelectedValue('#cameraExp');

      const record = {
        fields: {
          "Datum": new Date().toISOString().split('T')[0],
          "Key Purchase Driver": keyDriver,
          "AI Companion": trueAI,
          "Performance": performance,
          "Camera Experience": cameraExp
        }
      };

      const response = await fetch(`https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(TABLE_NAME)}`, {
        method: "POST",
        headers: {
          Authorization: `Bearer ${API_TOKEN}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(record)
      });

      if (response.ok) {
        alert("Uspješno poslano!");
        document.getElementById('decisionForm').reset();
        document.querySelectorAll('.radio').forEach(el => el.classList.remove('selected'));
      } else {
        alert("Greška prilikom slanja");
      }
    });
  </script>
</body>
</html>
